# cargo-release configuration
# Manages version bumping across all project files
# Single source of truth: versions are synchronized across C, Python, Rust, and Debian packaging

# Tag format
tag-name = "v{{version}}"
tag-message = "Release {{version}}"

# Don't publish to crates.io (handled by GitHub Actions)
publish = false

# Don't push automatically (gives us control to review first)
push = false

# Use single consolidated commit for workspace releases
consolidate-commits = true

# Automatic file updates during release
pre-release-replacements = [
  # Update C library header (single source of truth for C code)
  {file="include/videostream.h", search="#define VSL_VERSION \"[^\"]+\"", replace="#define VSL_VERSION \"{{version}}\"", exactly=1},

  # Update Python package version
  {file="pyproject.toml", search="version = \"[^\"]+\"", replace="version = \"{{version}}\"", exactly=1},

  # Update Sphinx documentation version
  {file="doc/conf.py", search="version = '[^']+'", replace="version = '{{version}}'", exactly=1},

  # Update NOTICE file (videostream-sys version in third-party notices)
  {file="NOTICE", search="videostream-sys [0-9]+\\.[0-9]+\\.[0-9]+", replace="videostream-sys {{version}}", exactly=1},

  # Note: debian/changelog is generated at build time from CHANGELOG.md
  # See debian/gen-changelog.py - no need to update it here
]
